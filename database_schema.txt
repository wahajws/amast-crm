-- ============================================
-- Database Schema Export
-- Database: crm_system
-- Exported: 2025-12-19T12:43:30.774Z
-- ============================================

USE crm_system;

-- Table: accounts
CREATE TABLE IF NOT EXISTS `accounts` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Company/Account name',
  `industry` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Industry type',
  `website` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Company website',
  `phone` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Primary phone number',
  `email` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Primary email address',
  `billing_street` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Billing address street',
  `billing_city` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Billing address city',
  `billing_state` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Billing address state',
  `billing_postal_code` varchar(20) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Billing postal code',
  `billing_country` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Billing country',
  `shipping_street` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Shipping address street',
  `shipping_city` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Shipping address city',
  `shipping_state` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Shipping address state',
  `shipping_postal_code` varchar(20) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Shipping postal code',
  `shipping_country` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Shipping country',
  `description` text COLLATE utf8mb4_unicode_ci COMMENT 'Account description',
  `annual_revenue` decimal(15,2) DEFAULT NULL COMMENT 'Annual revenue',
  `number_of_employees` int DEFAULT NULL COMMENT 'Number of employees',
  `owner_id` int DEFAULT NULL COMMENT 'Assigned user/owner',
  `status` enum('ACTIVE','INACTIVE','PROSPECT') COLLATE utf8mb4_unicode_ci DEFAULT 'ACTIVE',
  `created_by` int DEFAULT NULL COMMENT 'User who created this record',
  `updated_by` int DEFAULT NULL COMMENT 'User who last updated this record',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` timestamp NULL DEFAULT NULL COMMENT 'Soft delete timestamp',
  PRIMARY KEY (`id`),
  KEY `idx_name` (`name`),
  KEY `idx_industry` (`industry`),
  KEY `idx_owner_id` (`owner_id`),
  KEY `idx_status` (`status`),
  KEY `idx_created_at` (`created_at`),
  KEY `idx_deleted_at` (`deleted_at`),
  KEY `created_by` (`created_by`),
  KEY `updated_by` (`updated_by`),
  CONSTRAINT `accounts_ibfk_1` FOREIGN KEY (`owner_id`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `accounts_ibfk_2` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `accounts_ibfk_3` FOREIGN KEY (`updated_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=79 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='CRM Accounts/Companies table';

-- Table: audit_logs
CREATE TABLE IF NOT EXISTS `audit_logs` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int DEFAULT NULL,
  `action` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL,
  `resource_type` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL,
  `resource_id` int DEFAULT NULL,
  `description` text COLLATE utf8mb4_unicode_ci,
  `ip_address` varchar(45) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `user_agent` text COLLATE utf8mb4_unicode_ci,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_action` (`action`),
  KEY `idx_resource` (`resource_type`,`resource_id`),
  KEY `idx_created_at` (`created_at`),
  CONSTRAINT `audit_logs_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Table: company_profiles
CREATE TABLE IF NOT EXISTS `company_profiles` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int NOT NULL COMMENT 'User who created this profile',
  `company_url` varchar(500) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Company website URL',
  `company_name` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Company name extracted from website',
  `description` text COLLATE utf8mb4_unicode_ci COMMENT 'Company description (editable by user)',
  `products_services` text COLLATE utf8mb4_unicode_ci COMMENT 'Products and services information',
  `industry` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Primary industry',
  `target_market` text COLLATE utf8mb4_unicode_ci COMMENT 'Target market information',
  `company_size` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Company size (e.g., Small, Medium, Large)',
  `metadata` json DEFAULT NULL COMMENT 'Additional metadata from analysis',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` timestamp NULL DEFAULT NULL COMMENT 'Soft delete timestamp',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_company_url` (`company_url`(255)),
  KEY `idx_created_at` (`created_at`),
  KEY `idx_deleted_at` (`deleted_at`),
  CONSTRAINT `company_profiles_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=21 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='Company profiles for lead generation';

-- Table: contacts
CREATE TABLE IF NOT EXISTS `contacts` (
  `id` int NOT NULL AUTO_INCREMENT,
  `first_name` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'First name',
  `last_name` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Last name',
  `email` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Email address',
  `phone` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Phone number',
  `mobile` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Mobile number',
  `title` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Job title',
  `department` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Department',
  `account_id` int DEFAULT NULL COMMENT 'Linked account/company',
  `mailing_street` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Mailing address street',
  `mailing_city` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Mailing address city',
  `mailing_state` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Mailing address state',
  `mailing_postal_code` varchar(20) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Mailing postal code',
  `mailing_country` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Mailing country',
  `description` text COLLATE utf8mb4_unicode_ci COMMENT 'Contact description',
  `owner_id` int DEFAULT NULL COMMENT 'Assigned user/owner',
  `status` enum('ACTIVE','INACTIVE','LEAD') COLLATE utf8mb4_unicode_ci DEFAULT 'ACTIVE',
  `created_by` int DEFAULT NULL COMMENT 'User who created this record',
  `updated_by` int DEFAULT NULL COMMENT 'User who last updated this record',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` timestamp NULL DEFAULT NULL COMMENT 'Soft delete timestamp',
  `email_template` text COLLATE utf8mb4_unicode_ci COMMENT 'Generated email template for this contact',
  `email_subject` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Generated email subject for this contact',
  `email_generated_at` timestamp NULL DEFAULT NULL COMMENT 'Timestamp when email was generated',
  PRIMARY KEY (`id`),
  KEY `idx_name` (`first_name`,`last_name`),
  KEY `idx_email` (`email`),
  KEY `idx_account_id` (`account_id`),
  KEY `idx_owner_id` (`owner_id`),
  KEY `idx_status` (`status`),
  KEY `idx_created_at` (`created_at`),
  KEY `idx_deleted_at` (`deleted_at`),
  KEY `created_by` (`created_by`),
  KEY `updated_by` (`updated_by`),
  CONSTRAINT `contacts_ibfk_1` FOREIGN KEY (`account_id`) REFERENCES `accounts` (`id`) ON DELETE SET NULL,
  CONSTRAINT `contacts_ibfk_2` FOREIGN KEY (`owner_id`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `contacts_ibfk_3` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `contacts_ibfk_4` FOREIGN KEY (`updated_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=84 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='CRM Contacts table';

-- Table: email_attachments
CREATE TABLE IF NOT EXISTS `email_attachments` (
  `id` int NOT NULL AUTO_INCREMENT,
  `email_id` int NOT NULL COMMENT 'Email this attachment belongs to',
  `gmail_attachment_id` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Gmail attachment ID',
  `filename` varchar(500) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Attachment filename',
  `mime_type` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'MIME type of attachment',
  `size` bigint DEFAULT '0' COMMENT 'Size in bytes',
  `download_url` text COLLATE utf8mb4_unicode_ci COMMENT 'Temporary download URL or stored path',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_email_id` (`email_id`),
  KEY `idx_gmail_attachment_id` (`gmail_attachment_id`),
  CONSTRAINT `email_attachments_ibfk_1` FOREIGN KEY (`email_id`) REFERENCES `emails` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='Email attachments metadata';

-- Table: email_campaigns
CREATE TABLE IF NOT EXISTS `email_campaigns` (
  `id` int NOT NULL AUTO_INCREMENT,
  `contact_id` int NOT NULL COMMENT 'Contact this email is for',
  `account_id` int DEFAULT NULL COMMENT 'Account this email is for',
  `email_subject` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Email subject line',
  `email_template` text COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Email body/template',
  `status` enum('DRAFT','PENDING','SENT','OPENED','REPLIED','BOUNCED') COLLATE utf8mb4_unicode_ci DEFAULT 'PENDING' COMMENT 'Email status',
  `priority` enum('LOW','MEDIUM','HIGH','URGENT') COLLATE utf8mb4_unicode_ci DEFAULT 'MEDIUM' COMMENT 'Email priority',
  `sent_at` timestamp NULL DEFAULT NULL COMMENT 'When email was sent',
  `sent_by` int DEFAULT NULL COMMENT 'User who sent the email',
  `opened_at` timestamp NULL DEFAULT NULL COMMENT 'When email was opened (if tracked)',
  `replied_at` timestamp NULL DEFAULT NULL COMMENT 'When email was replied to (if tracked)',
  `communication_started` tinyint(1) DEFAULT '0' COMMENT 'Has communication started with client',
  `scheduled_send_at` timestamp NULL DEFAULT NULL COMMENT 'Scheduled send date/time',
  `notes` text COLLATE utf8mb4_unicode_ci COMMENT 'Additional notes',
  `owner_id` int NOT NULL COMMENT 'Owner of this email campaign',
  `created_by` int NOT NULL COMMENT 'User who created this campaign',
  `updated_by` int DEFAULT NULL COMMENT 'User who last updated this campaign',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` timestamp NULL DEFAULT NULL COMMENT 'Soft delete timestamp',
  PRIMARY KEY (`id`),
  KEY `idx_contact_id` (`contact_id`),
  KEY `idx_account_id` (`account_id`),
  KEY `idx_status` (`status`),
  KEY `idx_priority` (`priority`),
  KEY `idx_sent_at` (`sent_at`),
  KEY `idx_sent_by` (`sent_by`),
  KEY `idx_communication_started` (`communication_started`),
  KEY `idx_owner_id` (`owner_id`),
  KEY `idx_created_at` (`created_at`),
  KEY `idx_deleted_at` (`deleted_at`),
  KEY `created_by` (`created_by`),
  KEY `updated_by` (`updated_by`),
  CONSTRAINT `email_campaigns_ibfk_1` FOREIGN KEY (`contact_id`) REFERENCES `contacts` (`id`) ON DELETE CASCADE,
  CONSTRAINT `email_campaigns_ibfk_2` FOREIGN KEY (`account_id`) REFERENCES `accounts` (`id`) ON DELETE SET NULL,
  CONSTRAINT `email_campaigns_ibfk_3` FOREIGN KEY (`sent_by`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `email_campaigns_ibfk_4` FOREIGN KEY (`owner_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
  CONSTRAINT `email_campaigns_ibfk_5` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`) ON DELETE CASCADE,
  CONSTRAINT `email_campaigns_ibfk_6` FOREIGN KEY (`updated_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='Email campaigns and tracking';

-- Table: email_sync_logs
CREATE TABLE IF NOT EXISTS `email_sync_logs` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int NOT NULL COMMENT 'User whose emails were synced',
  `label_id` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Gmail label ID that was synced',
  `sync_type` enum('manual','automatic') COLLATE utf8mb4_unicode_ci DEFAULT 'manual' COMMENT 'Type of sync',
  `status` enum('success','failed','partial') COLLATE utf8mb4_unicode_ci DEFAULT 'success' COMMENT 'Sync status',
  `emails_synced` int DEFAULT '0' COMMENT 'Number of emails synced',
  `emails_skipped` int DEFAULT '0' COMMENT 'Number of emails skipped (duplicates)',
  `error_message` text COLLATE utf8mb4_unicode_ci COMMENT 'Error message if sync failed',
  `started_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'When sync started',
  `completed_at` timestamp NULL DEFAULT NULL COMMENT 'When sync completed',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_label_id` (`label_id`),
  KEY `idx_status` (`status`),
  KEY `idx_started_at` (`started_at`),
  CONSTRAINT `email_sync_logs_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=35 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='Logs of email sync operations';

-- Table: emails
CREATE TABLE IF NOT EXISTS `emails` (
  `id` int NOT NULL AUTO_INCREMENT,
  `gmail_message_id` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Gmail message ID - unique identifier',
  `thread_id` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Gmail thread ID for grouping conversations',
  `subject` varchar(500) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Email subject',
  `from_email` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Sender email address',
  `from_name` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Sender display name',
  `to_email` json DEFAULT NULL COMMENT 'Array of recipient email addresses',
  `cc_email` json DEFAULT NULL COMMENT 'Array of CC email addresses',
  `bcc_email` json DEFAULT NULL COMMENT 'Array of BCC email addresses',
  `body_text` text COLLATE utf8mb4_unicode_ci COMMENT 'Plain text email body',
  `body_html` longtext COLLATE utf8mb4_unicode_ci COMMENT 'HTML email body',
  `received_at` timestamp NULL DEFAULT NULL COMMENT 'When email was received',
  `sent_at` timestamp NULL DEFAULT NULL COMMENT 'When email was sent',
  `is_read` tinyint(1) DEFAULT '0' COMMENT 'Read status',
  `is_starred` tinyint(1) DEFAULT '0' COMMENT 'Starred status',
  `label_ids` json DEFAULT NULL COMMENT 'Array of Gmail label IDs',
  `attachment_count` int DEFAULT '0' COMMENT 'Number of attachments',
  `contact_id` int DEFAULT NULL COMMENT 'Linked contact (if matched)',
  `account_id` int DEFAULT NULL COMMENT 'Linked account (if matched)',
  `user_id` int NOT NULL COMMENT 'User who owns this email',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` timestamp NULL DEFAULT NULL COMMENT 'Soft delete',
  PRIMARY KEY (`id`),
  UNIQUE KEY `gmail_message_id` (`gmail_message_id`),
  KEY `idx_gmail_message_id` (`gmail_message_id`),
  KEY `idx_thread_id` (`thread_id`),
  KEY `idx_from_email` (`from_email`),
  KEY `idx_contact_id` (`contact_id`),
  KEY `idx_account_id` (`account_id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_received_at` (`received_at`),
  KEY `idx_deleted_at` (`deleted_at`),
  FULLTEXT KEY `idx_fulltext_search` (`subject`,`body_text`),
  CONSTRAINT `emails_ibfk_1` FOREIGN KEY (`contact_id`) REFERENCES `contacts` (`id`) ON DELETE SET NULL,
  CONSTRAINT `emails_ibfk_2` FOREIGN KEY (`account_id`) REFERENCES `accounts` (`id`) ON DELETE SET NULL,
  CONSTRAINT `emails_ibfk_3` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=683 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='Synced emails from Gmail';

-- Table: gmail_label_sync_settings
CREATE TABLE IF NOT EXISTS `gmail_label_sync_settings` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int NOT NULL COMMENT 'User who owns this label sync setting',
  `label_id` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Gmail label ID',
  `label_name` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Human-readable label name',
  `label_type` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT 'user' COMMENT 'Type: user or system (INBOX, SENT, etc.)',
  `is_syncing` tinyint(1) DEFAULT '0' COMMENT 'Whether user selected this label to sync',
  `last_synced_at` timestamp NULL DEFAULT NULL COMMENT 'Last time emails from this label were synced',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `unique_user_label` (`user_id`,`label_id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_is_syncing` (`is_syncing`),
  KEY `idx_label_id` (`label_id`),
  CONSTRAINT `gmail_label_sync_settings_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=32 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='Gmail label sync settings per user';

-- Table: notes
CREATE TABLE IF NOT EXISTS `notes` (
  `id` int NOT NULL AUTO_INCREMENT,
  `title` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Note title',
  `content` text COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Note content',
  `contact_id` int DEFAULT NULL COMMENT 'Linked contact (if tagged to contact)',
  `account_id` int DEFAULT NULL COMMENT 'Linked account (if tagged to account)',
  `created_by` int NOT NULL COMMENT 'User who created this note',
  `updated_by` int DEFAULT NULL COMMENT 'User who last updated this note',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` timestamp NULL DEFAULT NULL COMMENT 'Soft delete timestamp',
  `reminder_date` datetime DEFAULT NULL COMMENT 'Reminder date and time for this note',
  `reminder_status` enum('PENDING','COMPLETED','CANCELLED') COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Reminder status',
  `reminder_completed_at` timestamp NULL DEFAULT NULL COMMENT 'When the reminder was marked as completed',
  PRIMARY KEY (`id`),
  KEY `idx_contact_id` (`contact_id`),
  KEY `idx_account_id` (`account_id`),
  KEY `idx_created_by` (`created_by`),
  KEY `idx_created_at` (`created_at`),
  KEY `idx_deleted_at` (`deleted_at`),
  KEY `updated_by` (`updated_by`),
  KEY `idx_reminder_date` (`reminder_date`),
  KEY `idx_reminder_status` (`reminder_status`),
  CONSTRAINT `notes_ibfk_1` FOREIGN KEY (`contact_id`) REFERENCES `contacts` (`id`) ON DELETE CASCADE,
  CONSTRAINT `notes_ibfk_2` FOREIGN KEY (`account_id`) REFERENCES `accounts` (`id`) ON DELETE CASCADE,
  CONSTRAINT `notes_ibfk_3` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`) ON DELETE RESTRICT,
  CONSTRAINT `notes_ibfk_4` FOREIGN KEY (`updated_by`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `chk_note_target` CHECK ((((`contact_id` is not null) and (`account_id` is null)) or ((`contact_id` is null) and (`account_id` is not null))))
) ENGINE=InnoDB AUTO_INCREMENT=13 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='CRM Notes table (tagged to contacts or accounts)';

-- Table: opportunities
CREATE TABLE IF NOT EXISTS `opportunities` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Opportunity name',
  `description` text COLLATE utf8mb4_unicode_ci COMMENT 'Opportunity description',
  `account_id` int DEFAULT NULL COMMENT 'Linked account/company',
  `contact_id` int DEFAULT NULL COMMENT 'Primary contact for this opportunity',
  `stage` enum('PROSPECTING','QUALIFICATION','PROPOSAL','NEGOTIATION','CLOSED_WON','CLOSED_LOST') COLLATE utf8mb4_unicode_ci DEFAULT 'PROSPECTING',
  `probability` int DEFAULT '0' COMMENT 'Win probability percentage (0-100)',
  `amount` decimal(15,2) DEFAULT NULL COMMENT 'Opportunity value/amount',
  `expected_close_date` date DEFAULT NULL COMMENT 'Expected close date',
  `actual_close_date` date DEFAULT NULL COMMENT 'Actual close date',
  `owner_id` int DEFAULT NULL COMMENT 'Assigned user/owner',
  `status` enum('ACTIVE','WON','LOST','CANCELLED') COLLATE utf8mb4_unicode_ci DEFAULT 'ACTIVE',
  `created_by` int DEFAULT NULL COMMENT 'User who created this record',
  `updated_by` int DEFAULT NULL COMMENT 'User who last updated this record',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` timestamp NULL DEFAULT NULL COMMENT 'Soft delete timestamp',
  PRIMARY KEY (`id`),
  KEY `idx_name` (`name`),
  KEY `idx_account_id` (`account_id`),
  KEY `idx_contact_id` (`contact_id`),
  KEY `idx_stage` (`stage`),
  KEY `idx_status` (`status`),
  KEY `idx_owner_id` (`owner_id`),
  KEY `idx_expected_close_date` (`expected_close_date`),
  KEY `idx_created_at` (`created_at`),
  KEY `idx_deleted_at` (`deleted_at`),
  KEY `created_by` (`created_by`),
  KEY `updated_by` (`updated_by`),
  CONSTRAINT `opportunities_ibfk_1` FOREIGN KEY (`account_id`) REFERENCES `accounts` (`id`) ON DELETE SET NULL,
  CONSTRAINT `opportunities_ibfk_2` FOREIGN KEY (`contact_id`) REFERENCES `contacts` (`id`) ON DELETE SET NULL,
  CONSTRAINT `opportunities_ibfk_3` FOREIGN KEY (`owner_id`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `opportunities_ibfk_4` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `opportunities_ibfk_5` FOREIGN KEY (`updated_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=16 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='CRM Opportunities table';

-- Table: password_reset_tokens
CREATE TABLE IF NOT EXISTS `password_reset_tokens` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int NOT NULL COMMENT 'User requesting password reset',
  `token` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Reset token',
  `expires_at` timestamp NOT NULL COMMENT 'Token expiration time',
  `used_at` timestamp NULL DEFAULT NULL COMMENT 'When token was used',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `token` (`token`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_token` (`token`),
  KEY `idx_expires_at` (`expires_at`),
  CONSTRAINT `password_reset_tokens_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='Password reset tokens table';

-- Table: permissions
CREATE TABLE IF NOT EXISTS `permissions` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL,
  `display_name` varchar(200) COLLATE utf8mb4_unicode_ci NOT NULL,
  `description` text COLLATE utf8mb4_unicode_ci,
  `resource` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL,
  `action` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`),
  KEY `idx_resource_action` (`resource`,`action`),
  KEY `idx_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Table: proposals
CREATE TABLE IF NOT EXISTS `proposals` (
  `id` int NOT NULL AUTO_INCREMENT,
  `title` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Proposal title',
  `description` text COLLATE utf8mb4_unicode_ci COMMENT 'Proposal description',
  `opportunity_id` int DEFAULT NULL COMMENT 'Linked opportunity',
  `account_id` int DEFAULT NULL COMMENT 'Linked account/company',
  `contact_id` int DEFAULT NULL COMMENT 'Primary contact for this proposal',
  `proposal_number` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Proposal number/reference',
  `amount` decimal(15,2) DEFAULT NULL COMMENT 'Proposal amount/value',
  `currency` varchar(10) COLLATE utf8mb4_unicode_ci DEFAULT 'USD' COMMENT 'Currency code',
  `valid_until` date DEFAULT NULL COMMENT 'Proposal validity date',
  `status` enum('DRAFT','SENT','REVIEWED','APPROVED','REJECTED','ACCEPTED') COLLATE utf8mb4_unicode_ci DEFAULT 'DRAFT',
  `owner_id` int DEFAULT NULL COMMENT 'Assigned user/owner',
  `created_by` int DEFAULT NULL COMMENT 'User who created this record',
  `updated_by` int DEFAULT NULL COMMENT 'User who last updated this record',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` timestamp NULL DEFAULT NULL COMMENT 'Soft delete timestamp',
  PRIMARY KEY (`id`),
  KEY `idx_title` (`title`),
  KEY `idx_opportunity_id` (`opportunity_id`),
  KEY `idx_account_id` (`account_id`),
  KEY `idx_contact_id` (`contact_id`),
  KEY `idx_status` (`status`),
  KEY `idx_proposal_number` (`proposal_number`),
  KEY `idx_owner_id` (`owner_id`),
  KEY `idx_valid_until` (`valid_until`),
  KEY `idx_created_at` (`created_at`),
  KEY `idx_deleted_at` (`deleted_at`),
  KEY `created_by` (`created_by`),
  KEY `updated_by` (`updated_by`),
  CONSTRAINT `proposals_ibfk_1` FOREIGN KEY (`opportunity_id`) REFERENCES `opportunities` (`id`) ON DELETE SET NULL,
  CONSTRAINT `proposals_ibfk_2` FOREIGN KEY (`account_id`) REFERENCES `accounts` (`id`) ON DELETE SET NULL,
  CONSTRAINT `proposals_ibfk_3` FOREIGN KEY (`contact_id`) REFERENCES `contacts` (`id`) ON DELETE SET NULL,
  CONSTRAINT `proposals_ibfk_4` FOREIGN KEY (`owner_id`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `proposals_ibfk_5` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `proposals_ibfk_6` FOREIGN KEY (`updated_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=17 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='CRM Proposals table';

-- Table: reminders
CREATE TABLE IF NOT EXISTS `reminders` (
  `id` int NOT NULL AUTO_INCREMENT,
  `title` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Reminder title',
  `description` text COLLATE utf8mb4_unicode_ci COMMENT 'Reminder description',
  `contact_id` int DEFAULT NULL COMMENT 'Linked contact (if reminder for contact)',
  `account_id` int DEFAULT NULL COMMENT 'Linked account (if reminder for account)',
  `due_date` datetime NOT NULL COMMENT 'Due date and time',
  `priority` enum('LOW','MEDIUM','HIGH','URGENT') COLLATE utf8mb4_unicode_ci DEFAULT 'MEDIUM',
  `status` enum('PENDING','COMPLETED','CANCELLED') COLLATE utf8mb4_unicode_ci DEFAULT 'PENDING',
  `completed_at` timestamp NULL DEFAULT NULL COMMENT 'Completion timestamp',
  `created_by` int NOT NULL COMMENT 'User who created this reminder',
  `updated_by` int DEFAULT NULL COMMENT 'User who last updated this reminder',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` timestamp NULL DEFAULT NULL COMMENT 'Soft delete timestamp',
  PRIMARY KEY (`id`),
  KEY `idx_contact_id` (`contact_id`),
  KEY `idx_account_id` (`account_id`),
  KEY `idx_due_date` (`due_date`),
  KEY `idx_status` (`status`),
  KEY `idx_priority` (`priority`),
  KEY `idx_created_by` (`created_by`),
  KEY `idx_created_at` (`created_at`),
  KEY `idx_deleted_at` (`deleted_at`),
  KEY `updated_by` (`updated_by`),
  CONSTRAINT `reminders_ibfk_1` FOREIGN KEY (`contact_id`) REFERENCES `contacts` (`id`) ON DELETE CASCADE,
  CONSTRAINT `reminders_ibfk_2` FOREIGN KEY (`account_id`) REFERENCES `accounts` (`id`) ON DELETE CASCADE,
  CONSTRAINT `reminders_ibfk_3` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`) ON DELETE RESTRICT,
  CONSTRAINT `reminders_ibfk_4` FOREIGN KEY (`updated_by`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `chk_reminder_target` CHECK ((((`contact_id` is not null) and (`account_id` is null)) or ((`contact_id` is null) and (`account_id` is not null))))
) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='CRM Reminders table (tagged to contacts or accounts)';

-- Table: role_permissions
CREATE TABLE IF NOT EXISTS `role_permissions` (
  `id` int NOT NULL AUTO_INCREMENT,
  `role_id` int NOT NULL,
  `permission_id` int NOT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `unique_role_permission` (`role_id`,`permission_id`),
  KEY `idx_role_id` (`role_id`),
  KEY `idx_permission_id` (`permission_id`),
  CONSTRAINT `role_permissions_ibfk_1` FOREIGN KEY (`role_id`) REFERENCES `roles` (`id`) ON DELETE CASCADE,
  CONSTRAINT `role_permissions_ibfk_2` FOREIGN KEY (`permission_id`) REFERENCES `permissions` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Table: roles
CREATE TABLE IF NOT EXISTS `roles` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL,
  `display_name` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL,
  `description` text COLLATE utf8mb4_unicode_ci,
  `is_system_role` tinyint(1) DEFAULT '0',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`),
  KEY `idx_name` (`name`)
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Table: user_sessions
CREATE TABLE IF NOT EXISTS `user_sessions` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int NOT NULL,
  `token` varchar(500) COLLATE utf8mb4_unicode_ci NOT NULL,
  `refresh_token` varchar(500) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `ip_address` varchar(45) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `user_agent` text COLLATE utf8mb4_unicode_ci,
  `expires_at` datetime NOT NULL,
  `is_active` tinyint(1) DEFAULT '1',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `last_activity` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `token` (`token`),
  UNIQUE KEY `refresh_token` (`refresh_token`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_token` (`token`),
  KEY `idx_refresh_token` (`refresh_token`),
  KEY `idx_expires_at` (`expires_at`),
  CONSTRAINT `user_sessions_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=60 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Table: users
CREATE TABLE IF NOT EXISTS `users` (
  `id` int NOT NULL AUTO_INCREMENT,
  `email` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
  `password_hash` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `first_name` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `last_name` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `profile_picture` varchar(500) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `role_id` int NOT NULL,
  `status` enum('ACTIVE','INACTIVE','SUSPENDED','PENDING') COLLATE utf8mb4_unicode_ci DEFAULT 'ACTIVE',
  `gmail_access_token` text COLLATE utf8mb4_unicode_ci,
  `gmail_refresh_token` text COLLATE utf8mb4_unicode_ci,
  `gmail_token_expiry` datetime DEFAULT NULL,
  `last_login` datetime DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `created_by` int DEFAULT NULL,
  `updated_by` int DEFAULT NULL,
  `deleted_at` datetime DEFAULT NULL,
  `registration_token` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Token for email verification',
  `registration_token_expires_at` timestamp NULL DEFAULT NULL COMMENT 'Registration token expiration',
  `email_verified_at` timestamp NULL DEFAULT NULL COMMENT 'Email verification timestamp',
  `approved_at` timestamp NULL DEFAULT NULL COMMENT 'Admin approval timestamp',
  `approved_by` int DEFAULT NULL COMMENT 'Admin who approved the user',
  `failed_login_attempts` int DEFAULT '0' COMMENT 'Number of failed login attempts',
  `locked_until` timestamp NULL DEFAULT NULL COMMENT 'Account lock expiration time',
  `must_change_password` tinyint(1) DEFAULT '0' COMMENT 'Force password change on next login',
  PRIMARY KEY (`id`),
  UNIQUE KEY `email` (`email`),
  KEY `created_by` (`created_by`),
  KEY `updated_by` (`updated_by`),
  KEY `idx_email` (`email`),
  KEY `idx_role_id` (`role_id`),
  KEY `idx_status` (`status`),
  KEY `idx_deleted_at` (`deleted_at`),
  KEY `idx_registration_token` (`registration_token`),
  KEY `idx_email_verified_at` (`email_verified_at`),
  KEY `idx_approved_at` (`approved_at`),
  KEY `idx_locked_until` (`locked_until`),
  KEY `fk_users_approved_by` (`approved_by`),
  CONSTRAINT `fk_users_approved_by` FOREIGN KEY (`approved_by`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `users_ibfk_1` FOREIGN KEY (`role_id`) REFERENCES `roles` (`id`) ON DELETE RESTRICT,
  CONSTRAINT `users_ibfk_2` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `users_ibfk_3` FOREIGN KEY (`updated_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

